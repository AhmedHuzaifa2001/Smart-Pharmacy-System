{% extends 'base.html' %}

{% block title %}Medicine List{% endblock title %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<div class="container my-5">
  <h2 class="text-center mb-4">All Medicines</h2>
  <div class="text-center mb-4">
    <a href="{% url 'medicine_table' %}" class="btn btn-outline-primary">View as Table</a>
  </div>

  <!-- Filter Form -->
  <form method="get" class="row g-3 align-items-end mb-4">
    <div class="col-md-4">
      <label for="category" class="form-label">Category</label>
      <select name="category" id="category" class="form-select">
        <option value="">All</option>
        {% for cat in categories %}
          <option value="{{ cat }}" {% if request.GET.category == cat %}selected{% endif %}>{{ cat }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <label for="expiry" class="form-label">Expiry Status</label>
      <select name="expiry" id="expiry" class="form-select">
        <option value="">All</option>
        <option value="near" {% if request.GET.expiry == 'near' %}selected{% endif %}>Near Expiry</option>
        <option value="expired" {% if request.GET.expiry == 'expired' %}selected{% endif %}>Expired</option>
      </select>
    </div>
    <div class="col-md-3">
      <label for="low_stock" class="form-label">Stock Status</label>
      <select name="low_stock" id="low_stock" class="form-select">
        <option value="">All</option>
        <option value="low" {% if request.GET.low_stock == 'low' %}selected{% endif %}>Low Stock</option>
      </select>
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-primary w-100">Filter</button>
    </div>
  </form>

  <div class="row g-4">
    {% if medicine %}
      {% for med in medicine %}
        <div class="col-md-6 col-lg-4">
          <div class="card shadow-sm h-100">
            <div class="card-header bg-primary text-white">
              <strong>{{ med.name }}</strong>
              {% if med.near_expiry %}
                <span class="badge bg-danger">Near Expiry!</span>
              {% endif %}
              {% if med.low_stock %}
                <span class="badge bg-warning text-dark">Low Stock!</span>
              {% endif %}
            </div>
            <div class="card-body">
              <p><strong>Batch:</strong> {{ med.batch_number }}</p>
              <p><strong>Brand:</strong> {{ med.brand }}</p>
              <p><strong>Category:</strong> {{ med.category }}</p>
              <p><strong>Dosage:</strong> {{ med.dosage }}</p>
              <p><strong>Quantity:</strong> {{ med.quantity_in_stock }}</p>
            </div>
            <div class="card-footer d-flex justify-content-between">
              <a href="{% url 'medicine_update' med.id %}" class="btn btn-success btn-sm">Update</a>
              <a href="{% url 'medicine_delete' med.id %}" class="btn btn-danger btn-sm"
                 onclick="return confirm('Are you sure you want to delete this medicine?');">Delete</a>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="col-12">
        <div class="alert alert-info text-center">No medicines found.</div>
      </div>
    {% endif %}
  </div>
  <div class="text-center mt-4">
    <a href="{% url 'medicine_create' %}" class="btn btn-primary">âž• Add New Medicine</a>
  </div>
</div>
{% endblock content %}