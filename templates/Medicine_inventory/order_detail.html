{% extends 'Medicine_inventory/base.html' %}
{% load static %}

{% block title %}Order Details - {{ order.order_id }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100">
    <!-- Header Section -->
    <div class="bg-white/70 backdrop-blur-sm shadow-sm border-b border-white/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-3">
                        <div class="p-3 rounded-xl bg-gradient-to-r from-orange-500 to-red-500 text-white shadow-lg">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-slate-900 tracking-tight">Order #{{ order.order_id }}</h1>
                            <p class="text-sm text-slate-600">Detailed order information and management</p>
                        </div>
                    </div>
                </div>
                <nav class="flex" aria-label="Breadcrumb">
                    <ol class="flex items-center space-x-4">
                        <li>
                            <a href="{% url 'med_inventory_dash' %}" class="text-slate-400 hover:text-slate-600 transition-colors duration-200 p-2 rounded-lg hover:bg-slate-100">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
                                </svg>
                                <span class="sr-only">Dashboard</span>
                            </a>
                        </li>
                        <li>
                            <div class="flex items-center">
                                <svg class="w-4 h-4 text-slate-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                </svg>
                                <a href="{% url 'view_online_orders' %}" class="ml-3 text-sm font-medium text-slate-500 hover:text-slate-700 transition-colors duration-200">Online Orders</a>
                            </div>
                        </li>
                        <li>
                            <div class="flex items-center">
                                <svg class="w-4 h-4 text-slate-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="ml-3 text-sm font-medium text-slate-700">#{{ order.order_id }}</span>
                            </div>
                        </li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Quick Actions Bar -->
        <div class="mb-8 flex flex-wrap gap-4">
            <a href="{% url 'view_online_orders' %}" 
               class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-slate-600 to-slate-700 text-white rounded-xl hover:from-slate-700 hover:to-slate-800 transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-105">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Back to Orders
            </a>
            
            <!-- Status-specific Action Buttons -->
            {% if order.status == 'Pending' or order.status == 'Paid' %}
            <button onclick="openModal('processModal')" 
                    class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-600 to-cyan-600 text-white rounded-xl hover:from-blue-700 hover:to-cyan-700 transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-105">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                Start Processing
            </button>
            {% endif %}

            {% if order.status == 'Processing' %}
            <button onclick="openModal('shipModal')" 
                    class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-105">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Mark as Shipped
            </button>
            {% endif %}

            {% if order.status == 'Shipped' %}
            <button onclick="openModal('deliverModal')" 
                    class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-emerald-600 to-green-600 text-white rounded-xl hover:from-emerald-700 hover:to-green-700 transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-105">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Mark as Delivered
            </button>
            {% endif %}

            {% if order.status != 'Cancelled' and order.status != 'Delivered' %}
            <button onclick="openModal('cancelModal')" 
                    class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-red-600 to-pink-600 text-white rounded-xl hover:from-red-700 hover:to-pink-700 transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-105">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Cancel Order
            </button>
            {% endif %}
        </div>

        <!-- Order Information Cards -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Customer Information -->
            <div class="bg-white/70 backdrop-blur-sm rounded-2xl shadow-sm border border-white/50 overflow-hidden hover:shadow-lg transition-all duration-200">
                <div class="bg-gradient-to-r from-blue-500 to-cyan-500 px-6 py-4">
                    <h3 class="text-lg font-semibold text-white flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        Customer Information
                    </h3>
                </div>
                <div class="p-6">
                    <div class="flex items-center mb-6">
                        <div class="flex-shrink-0 h-16 w-16">
                            <div class="h-16 w-16 rounded-full bg-gradient-to-r from-blue-400 to-purple-500 flex items-center justify-center shadow-lg">
                                <span class="text-xl font-bold text-white">
                                    {{ customer.first_name|first|upper }}{{ customer.last_name|first|upper }}
                                </span>
                            </div>
                        </div>
                        <div class="ml-4">
                            <h4 class="text-lg font-semibold text-slate-900">{{ customer.first_name }} {{ customer.last_name }}</h4>
                            {% if customer.username %}
                            <p class="text-sm text-slate-500">@{{ customer.username }}</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center py-3 border-b border-slate-200/50">
                            <span class="text-sm font-medium text-slate-600">Full Name:</span>
                            <span class="text-sm text-slate-900 font-semibold">{{ customer.first_name }} {{ customer.last_name }}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-200/50">
                            <span class="text-sm font-medium text-slate-600">Username:</span>
                            <span class="text-sm text-slate-900">
                                {% if customer.username %}
                                    {{ customer.username }}
                                {% else %}
                                    <span class="text-slate-400 italic">Not provided</span>
                                {% endif %}
                            </span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-200/50">
                            <span class="text-sm font-medium text-slate-600">Email:</span>
                            <span class="text-sm text-slate-900">{{ customer.email }}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-200/50">
                            <span class="text-sm font-medium text-slate-600">Phone:</span>
                            <span class="text-sm text-slate-900">
                                {% if customer.phone %}
                                    {{ customer.phone }}
                                {% else %}
                                    <span class="text-slate-400 italic">Not provided</span>
                                {% endif %}
                            </span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-200/50">
                            <span class="text-sm font-medium text-slate-600">Date Joined:</span>
                            <span class="text-sm text-slate-900">{{ customer.date_joined|date:"M d, Y" }}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-200/50">
                            <span class="text-sm font-medium text-slate-600">Last Login:</span>
                            <span class="text-sm text-slate-900">
                                {% if customer.last_login %}
                                    {{ customer.last_login|date:"M d, Y H:i" }}
                                {% else %}
                                    <span class="text-slate-400 italic">Never</span>
                                {% endif %}
                            </span>
                        </div>
                        {% if order.shipping_address %}
                        <div class="flex justify-between items-start py-3 border-b border-slate-200/50">
                            <span class="text-sm font-medium text-slate-600">Shipping Address:</span>
                            <span class="text-sm text-slate-900 text-right max-w-xs">{{ order.shipping_address }}</span>
                        </div>
                        {% endif %}
                        {% if order.billing_address %}
                        <div class="flex justify-between items-start py-3">
                            <span class="text-sm font-medium text-slate-600">Billing Address:</span>
                            <span class="text-sm text-slate-900 text-right max-w-xs">{{ order.billing_address }}</span>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Customer Actions -->
                    <div class="mt-6 pt-4 border-t border-slate-200/50">
                        <div class="flex space-x-3">
                            <a href="mailto:{{ customer.email }}" class="flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 text-white px-4 py-2 rounded-xl hover:from-blue-700 hover:to-cyan-700 transition-all duration-200 text-center flex items-center justify-center shadow-lg hover:shadow-xl">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                </svg>
                                Email
                            </a>
                            {% if customer.phone %}
                            <a href="tel:{{ customer.phone }}" class="flex-1 bg-gradient-to-r from-emerald-600 to-green-600 text-white px-4 py-2 rounded-xl hover:from-emerald-700 hover:to-green-700 transition-all duration-200 text-center flex items-center justify-center shadow-lg hover:shadow-xl">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                </svg>
                                Call
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Order Information -->
            <div class="bg-white/70 backdrop-blur-sm rounded-2xl shadow-sm border border-white/50 overflow-hidden hover:shadow-lg transition-all duration-200">
                <div class="bg-gradient-to-r from-purple-500 to-violet-500 px-6 py-4">
                    <h3 class="text-lg font-semibold text-white flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Order Information
                    </h3>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        <div class="flex justify-between items-center py-3 border-b border-slate-200/50">
                            <span class="text-sm font-medium text-slate-600">Order ID:</span>
                            <span class="text-sm text-slate-900 font-mono bg-slate-100 px-3 py-1 rounded-lg">{{ order.order_id }}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-200/50">
                            <span class="text-sm font-medium text-slate-600">Status:</span>
                            {% if order.status == 'Pending' %}
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-amber-100 text-amber-800 border border-amber-200">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    Pending
                                </span>
                            {% elif order.status == 'Payment_Failed' %}
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800 border border-red-200">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                    </svg>
                                    Payment Failed
                                </span>
                            {% elif order.status == 'Paid' %}
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-emerald-100 text-emerald-800 border border-emerald-200">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                    Paid
                                </span>
                            {% elif order.status == 'Processing' %}
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 border border-blue-200">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    Processing
                                </span>
                            {% elif order.status == 'Shipped' %}
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-indigo-100 text-indigo-800 border border-indigo-200">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    Shipped
                                </span>
                            {% elif order.status == 'Delivered' %}
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800 border border-green-200">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    Delivered
                                </span>
                            {% elif order.status == 'Cancelled' %}
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-slate-100 text-slate-800 border border-slate-200">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    Cancelled
                                </span>
                            {% else %}
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-slate-100 text-slate-800 border border-slate-200">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    {{ order.status|title }}
                                </span>
                            {% endif %}
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-200/50">
                            <span class="text-sm font-medium text-slate-600">Order Date:</span>
                            <span class="text-sm text-slate-900">{{ order.created_at|date:"M d, Y H:i" }}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-200/50">
                            <span class="text-sm font-medium text-slate-600">Last Updated:</span>
                            <span class="text-sm text-slate-900">{{ order.updated_at|date:"M d, Y H:i" }}</span>
                        </div>
                        {% if order.payment_method %}
                        <div class="flex justify-between items-center py-3 border-b border-slate-200/50">
                            <span class="text-sm font-medium text-slate-600">Payment Method:</span>
                            <span class="text-sm text-slate-900">{{ order.payment_method|title }}</span>
                        </div>
                        {% endif %}
                        <div class="flex justify-between items-center py-3">
                            <span class="text-sm font-medium text-slate-600">Total Amount:</span>
                            <span class="text-lg font-bold text-emerald-600">${{ order.total_amount }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Update Status Card -->
        <div class="bg-white/70 backdrop-blur-sm rounded-2xl shadow-sm border border-white/50 overflow-hidden mb-8 hover:shadow-lg transition-all duration-200">
            <div class="bg-gradient-to-r from-orange-500 to-red-500 px-6 py-4">
                <h3 class="text-lg font-semibold text-white flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                    Update Order Status
                </h3>
            </div>
            <div class="p-6">
                <form method="POST" action="{% url 'update_order_status' order.order_id %}" class="flex flex-col sm:flex-row gap-4">
                    {% csrf_token %}
                    <div class="flex-1">
                        <select name="status" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all duration-200 bg-white/50 backdrop-blur-sm">
                            <option value="Pending" {% if order.status == 'Pending' %}selected{% endif %}>Pending</option>
                            <option value="Payment_Failed" {% if order.status == 'Payment_Failed' %}selected{% endif %}>Payment Failed</option>
                            <option value="Paid" {% if order.status == 'Paid' %}selected{% endif %}>Paid</option>
                            <option value="Processing" {% if order.status == 'Processing' %}selected{% endif %}>Processing</option>
                            <option value="Shipped" {% if order.status == 'Shipped' %}selected{% endif %}>Shipped</option>
                            <option value="Delivered" {% if order.status == 'Delivered' %}selected{% endif %}>Delivered</option>
                            <option value="Cancelled" {% if order.status == 'Cancelled' %}selected{% endif %}>Cancelled</option>
                        </select>
                    </div>
                    <button type="submit" class="px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-xl hover:from-orange-600 hover:to-red-600 focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-all duration-200 flex items-center shadow-lg hover:shadow-xl">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                        </svg>
                        Update Status
                    </button>
                </form>
            </div>
        </div>

        <!-- Order Items -->
        <div class="bg-white/70 backdrop-blur-sm rounded-2xl shadow-sm border border-white/50 overflow-hidden hover:shadow-lg transition-all duration-200">
            <div class="bg-gradient-to-r from-emerald-500 to-green-500 px-6 py-4">
                <h3 class="text-lg font-semibold text-white flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                    Order Items
                </h3>
            </div>
            <div class="p-6">
                {% if order_items %}
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-slate-50/50 border-b border-slate-200/50">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Product</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Brand</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Category</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Quantity</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Unit Price</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Total</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Stock Status</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white/50 divide-y divide-slate-200/50">
                            {% for item in order_items %}
                            <tr class="hover:bg-slate-50/50 transition-colors duration-200">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-slate-900">{{ item.product.name }}</div>
                                    {% if item.product.dosage %}
                                    <div class="text-sm text-slate-500">{{ item.product.dosage }}</div>
                                    {% endif %}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-slate-900">{{ item.product.brand|default:"N/A" }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-slate-100 text-slate-800 border border-slate-200">
                                        {{ item.product.category }}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200">
                                        {{ item.quantity }}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-slate-900">${{ item.price|floatformat:2 }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-semibold text-emerald-600">${{ item.total_price|floatformat:2 }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    {% if item.product.quantity_in_stock >= item.quantity %}
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                            </svg>
                                            In Stock ({{ item.product.quantity_in_stock }})
                                        </span>
                                    {% elif item.product.quantity_in_stock > 0 %}
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-800 border border-amber-200">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                            </svg>
                                            Low Stock ({{ item.product.quantity_in_stock }})
                                        </span>
                                    {% else %}
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 border border-red-200">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                            Out of Stock
                                        </span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot class="bg-slate-50/50 border-t border-slate-200/50">
                            <tr>
                                <th colspan="5" class="px-6 py-4 text-right text-sm font-medium text-slate-700">Total Order Amount:</th>
                                <th class="px-6 py-4 text-sm font-bold text-emerald-600">${{ order.total_amount }}</th>
                                <th class="px-6 py-4"></th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-12">
                    <svg class="w-12 h-12 mx-auto mb-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
                    </svg>
                    <h3 class="text-lg font-medium text-slate-900 mb-2">No items found</h3>
                    <p class="text-sm text-slate-500">This order doesn't have any items.</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Order Notes (if applicable) -->
        {% if order.notes %}
        <div class="bg-white/70 backdrop-blur-sm rounded-2xl shadow-sm border border-white/50 overflow-hidden mt-8 hover:shadow-lg transition-all duration-200">
            <div class="bg-gradient-to-r from-slate-500 to-slate-600 px-6 py-4">
                <h3 class="text-lg font-semibold text-white flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    Order Notes
                </h3>
            </div>
            <div class="p-6">
                <p class="text-slate-700">{{ order.notes }}</p>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Process Order Modal -->
<div id="processModal" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-6 w-96 max-w-md">
        <div class="bg-white/90 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20">
            <div class="p-6">
                <div class="flex items-center justify-center w-16 h-16 mx-auto bg-blue-100 rounded-full mb-4">
                    <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-slate-900 text-center mb-2">Start Processing Order</h3>
                <p class="text-sm text-slate-600 text-center mb-4">Mark this order as currently being processed?</p>
                <div class="bg-slate-50 rounded-xl p-4 mb-6 space-y-2">
                    <p class="text-sm text-slate-700"><strong>Order ID:</strong> {{ order.order_id }}</p>
                    <p class="text-sm text-slate-700"><strong>Customer:</strong> {{ customer.first_name }} {{ customer.last_name }}</p>
                </div>
                <div class="space-y-3">
                    <form method="POST" action="{% url 'update_order_status' order.order_id %}" class="w-full">
                        {% csrf_token %}
                        <input type="hidden" name="status" value="Processing">
                        <button type="submit" class="w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-cyan-600 text-white font-medium rounded-xl hover:from-blue-700 hover:to-cyan-700 transition-all duration-200 shadow-lg hover:shadow-xl">
                            Start Processing
                        </button>
                    </form>
                    <button onclick="closeModal('processModal')" class="w-full px-4 py-3 bg-slate-200 text-slate-800 font-medium rounded-xl hover:bg-slate-300 transition-all duration-200">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Ship Order Modal -->
<div id="shipModal" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-6 w-96 max-w-md">
        <div class="bg-white/90 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20">
            <div class="p-6">
                <div class="flex items-center justify-center w-16 h-16 mx-auto bg-indigo-100 rounded-full mb-4">
                    <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-slate-900 text-center mb-2">Ship Order</h3>
                <p class="text-sm text-slate-600 text-center mb-4">Mark this order as shipped?</p>
                <div class="bg-slate-50 rounded-xl p-4 mb-6 space-y-2">
                    <p class="text-sm text-slate-700"><strong>Order ID:</strong> {{ order.order_id }}</p>
                    <p class="text-sm text-slate-700"><strong>Customer:</strong> {{ customer.first_name }} {{ customer.last_name }}</p>
                </div>
                <div class="space-y-3">
                    <form method="POST" action="{% url 'update_order_status' order.order_id %}" class="w-full">
                        {% csrf_token %}
                        <input type="hidden" name="status" value="Shipped">
                        <button type="submit" class="w-full px-4 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-medium rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl">
                            Mark as Shipped
                        </button>
                    </form>
                    <button onclick="closeModal('shipModal')" class="w-full px-4 py-3 bg-slate-200 text-slate-800 font-medium rounded-xl hover:bg-slate-300 transition-all duration-200">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Deliver Order Modal -->
<div id="deliverModal" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-6 w-96 max-w-md">
        <div class="bg-white/90 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20">
            <div class="p-6">
                <div class="flex items-center justify-center w-16 h-16 mx-auto bg-green-100 rounded-full mb-4">
                    <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-slate-900 text-center mb-2">Mark as Delivered</h3>
                <p class="text-sm text-slate-600 text-center mb-4">Mark this order as successfully delivered?</p>
                <div class="bg-slate-50 rounded-xl p-4 mb-6 space-y-2">
                    <p class="text-sm text-slate-700"><strong>Order ID:</strong> {{ order.order_id }}</p>
                    <p class="text-sm text-slate-700"><strong>Customer:</strong> {{ customer.first_name }} {{ customer.last_name }}</p>
                </div>
                <div class="space-y-3">
                    <form method="POST" action="{% url 'update_order_status' order.order_id %}" class="w-full">
                        {% csrf_token %}
                        <input type="hidden" name="status" value="Delivered">
                        <button type="submit" class="w-full px-4 py-3 bg-gradient-to-r from-emerald-600 to-green-600 text-white font-medium rounded-xl hover:from-emerald-700 hover:to-green-700 transition-all duration-200 shadow-lg hover:shadow-xl">
                            Mark as Delivered
                        </button>
                    </form>
                    <button onclick="closeModal('deliverModal')" class="w-full px-4 py-3 bg-slate-200 text-slate-800 font-medium rounded-xl hover:bg-slate-300 transition-all duration-200">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Cancel Order Modal -->
<div id="cancelModal" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-6 w-96 max-w-md">
        <div class="bg-white/90 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20">
            <div class="p-6">
                <div class="flex items-center justify-center w-16 h-16 mx-auto bg-red-100 rounded-full mb-4">
                    <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-slate-900 text-center mb-2">Cancel Order</h3>
                <p class="text-sm text-slate-600 text-center mb-4">Are you sure you want to cancel this order?</p>
                <div class="bg-slate-50 rounded-xl p-4 mb-4 space-y-2">
                    <p class="text-sm text-slate-700"><strong>Order ID:</strong> {{ order.order_id }}</p>
                    <p class="text-sm text-slate-700"><strong>Customer:</strong> {{ customer.first_name }} {{ customer.last_name }}</p>
                </div>
                
                <!-- Inventory Restoration Notice -->
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-4">
                    <div class="flex items-start">
                        <svg class="w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p class="text-sm text-blue-700">
                            <strong>Note:</strong> Cancelling this order will automatically restore all items back to the medicine inventory.
                        </p>
                    </div>
                </div>
                
                <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6">
                    <div class="flex items-start">
                        <svg class="w-5 h-5 text-amber-600 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        <p class="text-sm text-amber-700">This action cannot be undone.</p>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <form method="POST" action="{% url 'update_order_status' order.order_id %}" class="w-full">
                        {% csrf_token %}
                        <input type="hidden" name="status" value="Cancelled">
                        <button type="submit" class="w-full px-4 py-3 bg-gradient-to-r from-red-600 to-pink-600 text-white font-medium rounded-xl hover:from-red-700 hover:to-pink-700 transition-all duration-200 shadow-lg hover:shadow-xl">
                            Cancel Order & Restore Inventory
                        </button>
                    </form>
                    <button onclick="closeModal('cancelModal')" class="w-full px-4 py-3 bg-slate-200 text-slate-800 font-medium rounded-xl hover:bg-slate-300 transition-all duration-200">
                        Keep Order
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function openModal(modalId) {
    document.getElementById(modalId).classList.remove('hidden');
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modals = ['processModal', 'shipModal', 'deliverModal', 'cancelModal'];
    modals.forEach(modalId => {
        const modal = document.getElementById(modalId);
        if (event.target == modal) {
            modal.classList.add('hidden');
        }
    });
}
</script>
{% endblock %}