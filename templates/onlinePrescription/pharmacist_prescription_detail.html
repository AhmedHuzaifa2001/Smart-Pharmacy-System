{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Pharmacist — Prescription #{{ prescription.id }}</h2>
        <div>
            <a href="{% url 'onlinePrescription:pharmacist_list' %}" class="btn btn-outline-secondary">Back to queue</a>
            <a href="{% url 'onlinePrescription:detail' prescription.pk %}" class="btn btn-outline-primary ms-2">Public view</a>
        </div>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <div class="row g-3">
        <div class="col-md-5">
            {% if prescription.prescription_image %}
                <div class="card">
                    <img src="{{ prescription.prescription_image.url }}" class="card-img-top" alt="Prescription image" style="max-height:700px; object-fit:contain;">
                    <div class="card-body">
                        <p class="mb-0"><strong>Uploaded:</strong> {{ prescription.uploaded_at|date:"SHORT_DATETIME_FORMAT" }}</p>
                        <p class="mb-0"><strong>Uploaded by:</strong> {{ prescription.user.get_full_name|default:prescription.user.username }}</p>
                    </div>
                </div>
            {% else %}
                <div class="alert alert-warning">No image available.</div>
            {% endif %}
        </div>

        <div class="col-md-7">
            <table class="table table-borderless">
                <tr>
                    <th style="width:160px">NIC</th>
                    <td>{{ prescription.nic }}</td>
                </tr>
                <tr>
                    <th>Status</th>
                    <td>
                        <span class="badge 
                            {% if prescription.status == 'Pending' %}bg-secondary
                            {% elif prescription.status == 'Reviewed' %}bg-info
                            {% elif prescription.status == 'Approved' %}bg-success
                            {% elif prescription.status == 'Rejected' %}bg-danger
                            {% else %}bg-light text-dark{% endif %}">
                            {{ prescription.status }}
                        </span>
                    </td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>{% if prescription.notes %}{{ prescription.notes|linebreaksbr }}{% else %}<em>—</em>{% endif %}</td>
                </tr>
                <tr>
                    <th>Pharmacist comment</th>
                    <td>{% if prescription.pharmacist_comment %}{{ prescription.pharmacist_comment|linebreaksbr }}{% else %}<em>—</em>{% endif %}</td>
                </tr>
                <tr>
                    <th>Order</th>
                    <td>
                        {% if prescription.order %}
                            <a href="{% url 'onlineStore:order_detail' prescription.order.pk %}">Order #{{ prescription.order.order_id }}</a>
                            {% if request.user.is_staff %}
                                &middot; <a href="{% url 'admin:%s_%s_change' prescription.order._meta.app_label prescription.order._meta.model_name prescription.order.pk %}">Open in admin</a>
                            {% endif %}
                        {% else %}
                            <em>Not attached</em>
                        {% endif %}
                    </td>
                </tr>
            </table>

            <div class="mt-3 d-flex gap-2">
                <a href="{% url 'onlinePrescription:pharmacist_review' prescription.pk %}" class="btn btn-success">Review / Update</a>
                <a href="{% url 'onlinePrescription:detail' prescription.pk %}" class="btn btn-outline-primary">View public</a>
                <a href="{% url 'onlinePrescription:pharmacist_list' %}" class="btn btn-link">Back to queue</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}