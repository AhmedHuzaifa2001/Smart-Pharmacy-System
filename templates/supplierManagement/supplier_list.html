{% extends "base.html" %}

{% block title %}Suppliers{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="m-0">Suppliers</h3>
  <a href="{% url 'suppliers:add' %}" class="btn btn-primary">+ Add Supplier</a>
</div>

<form method="get" class="row g-2 mb-3">
  <div class="col-md-4">
    <input type="text" name="q" value="{{ current_q }}" class="form-control" placeholder="Search name, contact Person">
  </div>
  <div class="col-md-3">
    <select name="product_type" class="form-select">
      <option value="">All Product Types</option>
      {% for pt in product_types %}
        <option value="{{ pt }}" {% if current_product_type == pt %}selected{% endif %}>{{ pt }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3">
    <select name="status" class="form-select">
      <option value="">All Status</option>
      <option value="Active" {% if current_status == "Active" %}selected{% endif %}>Active</option>
      <option value="Inactive" {% if current_status == "Inactive" %}selected{% endif %}>Inactive</option>
      <option value="Blacklisted" {% if current_status == "Blacklisted" %}selected{% endif %}>Blacklisted</option>
    </select>
  </div>
  <div class="col-md-2 d-grid">
    <button class="btn btn-secondary">Filter</button>
  </div>
</form>

<div class="card">
  <div class="table-responsive">
    <table class="table table-hover table-striped mb-0">
      <thead class="table-light">
        <tr>
          <th>Supplier Name</th>
          <th>Contact Person</th>
          <th>Contact Number</th>
          <th>Product Categories</th>
          <th>Status</th>
          <th style="width:160px;">Actions</th>
        </tr>
      </thead>
      <tbody>
      {% for s in suppliers %}
        <tr>
          <td class="fw-semibold">
            <a href="{% url 'suppliers:detail' s.pk %}">{{ s.name }}</a>
          </td>
          <td>
            {{ s.contact_person|default:"—" }}
          </td>
          <td> {{ s.phone|default:"" }}</td>
          <td>
            {% for product in s.products.all %}
              <span class="badge text-bg-info">{{ product.category }}</span>
            {% empty %}
              <span class="text-muted">No Products</span>
            {% endfor %}
          </td>
          <td>
            {% if s.status == "Active" %}
              <span class="badge text-bg-success">Active</span>
            {% elif s.status == "Inactive" %}
              <span class="badge text-bg-secondary">Inactive</span>
            {% elif s.status == "Blacklisted" %}
              <span class="badge text-bg-danger">Blacklisted</span>
            {% else %}
              <span class="badge text-bg-light">Unknown</span>
            {% endif %}
          </td>
          <td>
            <div class="btn-group btn-group-sm">
              <a class="btn btn-primary" href="{% url 'suppliers:detail' s.pk %}">View</a>
              <a class="btn btn-warning" href="{% url 'suppliers:edit' s.pk %}">Edit</a>
              <a class="btn btn-danger" href="{% url 'suppliers:delete' s.pk %}">Delete</a>
            </div>
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="6" class="text-center py-4 text-muted">No suppliers found.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

  {% if is_paginated %}
  <div class="card-footer">
    <nav>
      <ul class="pagination mb-0">
        {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}&q={{ current_q }}&product_type={{ current_product_type }}&status={{ current_status }}">«</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">«</span></li>
        {% endif %}

        {% for num in paginator.page_range %}
          {% if num == page_obj.number %}
            <li class="page-item active"><span class="page-link">{{ num }}</span></li>
          {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <li class="page-item">
              <a class="page-link" href="?page={{ num }}&q={{ current_q }}&product_type={{ current_product_type }}&status={{ current_status }}">{{ num }}</a>
            </li>
          {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}&q={{ current_q }}&product_type={{ current_product_type }}&status={{ current_status }}">»</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">»</span></li>
        {% endif %}
      </ul>
    </nav>
  </div>
  {% endif %}
</div>
{% endblock %}